<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Minnesota Population Center" />

<meta name="date" content="2017-12-15" />

<title>ipumsr Example - CPS</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore"><code>ipumsr</code> Example - CPS</h1>
<h4 class="author"><em>Minnesota Population Center</em></h4>
<h4 class="date"><em>2017-12-15</em></h4>



<section id="ipums---cps-extraction-and-analysis" class="level1">
<h1>IPUMS - CPS Extraction and Analysis</h1>
<section id="exercise-1" class="level2">
<h2>Exercise 1</h2>
<p>OBJECTIVE: Gain an understanding of how the IPUMS dataset is structured and how it can be leveraged to explore your research interests. This exercise will use the IPUMS dataset to explore associations between health and work status and to create basic frequencies of food stamp usage.</p>
<p>This vignette is adapted from the CPS Data Training Exercise available here: <a href="https://pop.umn.edu/sites/pop.umn.edu/files/final_review_-_cps_spss_exercise_1_0.pdf" class="uri">https://pop.umn.edu/sites/pop.umn.edu/files/final_review_-_cps_spss_exercise_1_0.pdf</a></p>
<section id="research-questions" class="level3">
<h3>Research Questions</h3>
<p>What is the frequency of food stamp recipiency in the US? Are health and work statuses related?</p>
</section>
<section id="objectives" class="level3">
<h3>Objectives</h3>
<ul>
<li>Create and download an IPUMS data extract</li>
<li>Decompress data file and read data into R</li>
<li>Analyze the data using sample code</li>
<li>Validate data analysis work using answer key</li>
</ul>
</section>
<section id="ipums-variables" class="level3">
<h3>IPUMS Variables</h3>
<ul>
<li>PERNUM: Person number in sample unit</li>
<li>FOODSTMP: Food stamp receipt</li>
<li>AGE: Age</li>
<li>EMPSTAT: Employment status</li>
<li>AHRSWORKT: Hours worked last week</li>
<li>HEALTH: Health status</li>
</ul>
</section>
</section>
<section id="download-extract-from-ipums-website" class="level2">
<h2>Download Extract from IPUMS Website</h2>
<ol type="1">
<li><p><strong>Register with IPUMS</strong> - Go to <a href="http://cps.ipums.org" class="uri">http://cps.ipums.org</a>, click on CPS Registration and apply for access. On login screen, enter email address and password and submit it!</p></li>
<li><strong>Make an Extract</strong></li>
</ol>
<ul>
<li>Go to <a href="http://cps.ipums.org" class="uri">http://cps.ipums.org</a>, click on CPS Registration and Apply for access</li>
<li>On login screen, enter email address and password and submit</li>
<li>Go back to homepage and go to Select Data</li>
<li>Click the Select Samples box, check the box for the 2011 ASEC sample, click the Submit sample selections box</li>
<li>Using the drop down menu or search feature, select the following variables:
<ul>
<li>PERNUM: Person number in sample unit (under Person &gt; Technical in the drop down)</li>
<li>FOODSTMP: Food stamp receipt (under Household &gt; Economic Characteristics; note that we do not want “FOODSTAMP: Family market value of food stamps”)</li>
<li>AGE: Age (under Person &gt; Core Demographic)</li>
<li>EMPSTAT: Employment status (under Person &gt; Work)</li>
<li>AHRSWORKT: Hours worked last week (under Person &gt; Work)</li>
<li>HEALTH: Health status (under Person &gt; Disability)</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li><strong>Request the Data</strong></li>
</ol>
<ul>
<li>Click the orange VIEW CART button under your data cart</li>
<li>Review variable selection. Click the orange Create Data Extract button</li>
<li>Review the ‘Extract Request Summary’ screen, describe your extract and click Submit Extract</li>
<li>You will get an email when the data is available to download</li>
<li>To get to the page to download the data, follow the link in the email, or follow the Download and Revise Extracts link on the homepage</li>
</ul>
<ol start="4" type="1">
<li><strong>Download the Data</strong></li>
</ol>
<ul>
<li>Go to <a href="http://cps.ipums.org" class="uri">http://cps.ipums.org</a> and click on Download or Revise Extracts</li>
<li>Right-click on the data link next to extract you created</li>
<li>Choose “Save Target As…” (or “Save Link As…”)</li>
<li>Save into “Documents” (that should pop up as the default location)</li>
<li>Do the same thing for the DDI link next to the extract</li>
</ul>
</section>
<section id="getting-the-data-into-r" class="level2">
<h2>Getting the data into R</h2>
<p>You will need to change the filepaths noted below to the place where you have saved the extracts.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(ipumsr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># Change these filepaths to the filepaths of your downloaded extract</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">cps_ddi_file &lt;-<span class="st"> &quot;cps_00001.xml&quot;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">cps_data_file &lt;-<span class="st"> &quot;cps_00001.dat&quot;</span></a></code></pre></div>
<pre><code>#&gt; Could not find CPS data and so could not run vignette.
#&gt; 
#&gt; If you tried to download the data following the instructions above, please makesure that the filenames are correct: 
#&gt; ddi - cps_00001.xml
#&gt; data - cps_00001.dat
#&gt; And that you are in the correct directory if you are using a relative path:
#&gt; Current directory - C:/Users/umn-burkx031/AppData/Local/Temp/Rtmpm6X7mY/Rbuilde8418a62dc1/ipumsr/vignettes
#&gt; 
#&gt; The data is also available on github. You can install it using the following commands: 
#&gt;   if (!require(devtools)) install.packages('devtools')
#&gt;   devtools::install_github('mnpopcenter/ipumsr/ipumsexamples')
#&gt; After installation, the data should be available for this vignette.</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">cps_ddi &lt;-<span class="st"> </span><span class="kw">read_ipums_ddi</span>(cps_ddi_file) <span class="co"># Contains metadata, nice to have as separate object</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">cps_data &lt;-<span class="st"> </span><span class="kw">read_ipums_micro</span>(cps_ddi_file, <span class="dt">data_file =</span> cps_data_file)</a></code></pre></div>
<p>Note that the <code>data_file</code> argument is optional if you didn’t change the data file name and have it saved in your working directory; <code>read_ipums_micro</code> can use information from the DDI file to locate the corresponding data file.</p>
</section>
<section id="exercises" class="level2">
<h2>Exercises</h2>
<p>These exercises include example code written in the “tidyverse” style, meaning that they use the dplyr package. This package provides easy to use functions for data analysis, including <code>mutate()</code>, <code>select()</code>, <code>arrange()</code>, <code>slice()</code> and the pipe (<code>%&gt;%</code>). There a numerous other ways you could solve these answers, including using the base R, the <code>data.table</code> package and others.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<section id="analyze-the-sample-part-i-frequencies-of-foodstmp" class="level3">
<h3>Analyze the Sample – Part I Frequencies of FOODSTMP</h3>
<ol type="A">
<li>On the website, find the codes page for the FOODSTMP variable and write down the code value, and what category each code represents.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Can find on the website or from the data</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">ipums_val_labels</span>(cps_ddi, FOODSTMP)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#    A: 0 = NIU, 1 = No, 2 = Yes</span></a></code></pre></div>
<ol start="2" type="A">
<li>What is the universe for FOODSTMP in 2011 (under the Universe tab on the website)?</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ipums_website</span>(cps_ddi, <span class="st">&quot;FOODSTMP&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#    A: (Only available on website)</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#       All interviewed households and group quarters. </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#       Note the NIU on the codes page, this is a household variable and the</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#       NIU cases are the vacant households.</span></a></code></pre></div>
<ol start="3" type="A">
<li>How many people received food stamps in 2011?</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># We will be working with the FOODSTMP variable a lot, so </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co"># let's turn it into a factor</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">cps_data &lt;-<span class="st"> </span>cps_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FOODSTMP_factor =</span> <span class="kw">as_factor</span>(FOODSTMP))</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">cps_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(FOODSTMP_factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n_foodstmp =</span> <span class="kw">sum</span>(WTSUPP)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct_foodstmp =</span> n_foodstmp <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n_foodstmp))</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#    A: 39,187,348</span></a></code></pre></div>
<ol start="4" type="A">
<li>What proportion of the population received food stamps in 2011?</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#    A: 12.8% (found in code from previous question)</span></a></code></pre></div>
</section>
<section id="using-household-weights-hwtsupp" class="level3">
<h3>Using household weights (HWTSUPP)</h3>
<p>Suppose you were interested not in the number of people living in homes that received food stamps, but in the number of households that were food stamp participants. To get this statistic you would need to use the household weight.</p>
<p>In order to use household weight, you should be careful to select only one person from each household to represent that household’s characteristics. You will need to apply the household weight (HWTSUPP).</p>
<ol type="A">
<li>How many households received food stamps in 2011?</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">cps_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(SERIAL) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(FOODSTMP_factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n_foodstmp =</span> <span class="kw">sum</span>(HWTSUPP)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct_foodstmp =</span> n_foodstmp <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n_foodstmp))</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#    A: 12,855,283</span></a></code></pre></div>
<ol start="2" type="A">
<li>What proportion of households received food stamps in 2011?</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">#    A: 10.7% (found in code from previous question)</span></a></code></pre></div>
</section>
<section id="analyze-the-sample-part-ii-relationships-in-the-data" class="level3">
<h3>Analyze the Sample – Part II Relationships in the Data</h3>
<ol type="A">
<li>What is the universe for EMPSTAT in 2011?</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">ipums_website</span>(cps_ddi, <span class="st">&quot;EMPSTAT&quot;</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#    A: Age 15+</span></a></code></pre></div>
<ol start="2" type="A">
<li>What are the possible responses and codes for the self-reported HEALTH variable?</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">ipums_val_labels</span>(cps_ddi, HEALTH)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#    A: 1 = Excellent, 2 = Very Good, 3 = Good, 4 = Fair, 5 = Poor</span></a></code></pre></div>
<ol start="3" type="A">
<li>What percent of people with ‘poor’ self-reported health are at work?</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">cps_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(HEALTH <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">emp_pct =</span> <span class="kw">weighted.mean</span>(EMPSTAT <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, WTSUPP))</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#    A: 11.6%</span></a></code></pre></div>
<ol start="4" type="A">
<li>What percent of people with ‘very good’ self-reported health are at work?</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">cps_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(HEALTH <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">emp_pct =</span> <span class="kw">weighted.mean</span>(EMPSTAT <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, WTSUPP))</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#    A: 51.6%</span></a></code></pre></div>
<ol start="5" type="A">
<li>In the EMPSTAT universe, what percent of people:</li>
</ol>
<ol type="i">
<li>self-report ‘poor’ health and are at work?</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">ipums_val_labels</span>(cps_ddi, EMPSTAT)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co"># 10 is the code for &quot;At work&quot;</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">pct_emp_by_health &lt;-<span class="st"> </span>cps_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(AGE <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HEALTH_factor =</span> <span class="kw">as_factor</span>(HEALTH)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(HEALTH_factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">emp_pct =</span> <span class="kw">weighted.mean</span>(EMPSTAT <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, WTSUPP))</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">pct_emp_by_health</a>
<a class="sourceLine" id="cb15-12" data-line-number="12"></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#    A: 11.8%</span></a></code></pre></div>
<ol start="2" type="i">
<li>self-report ‘very good’ health and are at work?</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">#    A: 64.0% (found in code from previous question)</span></a></code></pre></div>
</section>
<section id="analyze-the-sample-part-iii-relationships-in-the-data" class="level3">
<h3>Analyze the Sample – Part III Relationships in the Data</h3>
<ol type="A">
<li>What is the universe for AHRSWORK?</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">ipums_website</span>(cps_ddi, <span class="st">&quot;AHRSWORK&quot;</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#     A: Civilians age 15+, at work last week</span></a></code></pre></div>
<ol start="2" type="A">
<li>What are the average hours of work for each self-reported health category?</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">avg_hrs_by_health &lt;-<span class="st"> </span>cps_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(AGE <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>AHRSWORKT <span class="op">&lt;</span><span class="st"> </span><span class="dv">999</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">HEALTH_factor =</span> <span class="kw">as_factor</span>(HEALTH)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(HEALTH_factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_hours_worked =</span> <span class="kw">weighted.mean</span>(AHRSWORKT, WTSUPP))</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">avg_hrs_by_health </a>
<a class="sourceLine" id="cb18-8" data-line-number="8"></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#     A: Excellent  38.4</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#        Very good  38.7</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#        Good       37.8</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#        Fair       35.7</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#        Poor       32.4</span></a></code></pre></div>
</section>
<section id="bonus" class="level3">
<h3>Bonus</h3>
<ol type="A">
<li>Use the <code>ipumsr</code> package metadata functions (like <code>ipums_var_label()</code> and <code>ipums_file_info()</code>) and <code>ggplot2</code> to make a graph of the relationship between HEALTH and percent employed (from Part III above).</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">x_label &lt;-<span class="st"> </span><span class="kw">ipums_var_label</span>(cps_data, HEALTH)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">source_info &lt;-<span class="st"> </span><span class="kw">ipums_file_info</span>(cps_ddi, <span class="st">&quot;ipums_project&quot;</span>)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="kw">ggplot</span>(pct_emp_by_health, <span class="kw">aes</span>(<span class="dt">x =</span> HEALTH_factor, <span class="dt">y =</span> emp_pct)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#00263a&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_x_discrete</span>(x_label) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Percent employed&quot;</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">    <span class="dt">title =</span> <span class="st">&quot;Low Self-Reported Health Status Correlated with Unemployment&quot;</span>, </a>
<a class="sourceLine" id="cb19-12" data-line-number="12">    <span class="dt">subtitle =</span> <span class="st">&quot;Among age 15+ from CPS 2011 ASEC sample&quot;</span>,</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">    <span class="dt">caption =</span> <span class="kw">paste0</span>(<span class="st">&quot;Source: &quot;</span>, source_info)</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">  )</a></code></pre></div>
<ol start="2" type="A">
<li>Are there any variables that might be confounding this relationship? How might you explore this relationship?</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># Age is likely correlated with self-reported health and employment, so a good </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co"># analysis would control for this.</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co"># One way to do so graphically is to make faceted plots by age group</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">pct_emp_by_health_age &lt;-<span class="st"> </span>cps_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(AGE <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    <span class="dt">AGE_factor =</span> <span class="kw">cut</span>(</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">      AGE, </a>
<a class="sourceLine" id="cb20-10" data-line-number="10">      <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">65</span>, <span class="kw">max</span>(AGE)), </a>
<a class="sourceLine" id="cb20-11" data-line-number="11">      <span class="kw">c</span>(<span class="st">&quot;15-24&quot;</span>, <span class="st">&quot;25-34&quot;</span>, <span class="st">&quot;35-44&quot;</span>, <span class="st">&quot;45-54&quot;</span>, <span class="st">&quot;55-64&quot;</span>, <span class="st">&quot;65+&quot;</span>),</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">      <span class="dt">include.lowest =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13">    ),</a>
<a class="sourceLine" id="cb20-14" data-line-number="14">    <span class="dt">HEALTH_factor =</span> <span class="kw">as_factor</span>(HEALTH)</a>
<a class="sourceLine" id="cb20-15" data-line-number="15">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="st">  </span><span class="kw">group_by</span>(HEALTH_factor, AGE_factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">emp_pct =</span> <span class="kw">weighted.mean</span>(EMPSTAT <span class="op">==</span><span class="st"> </span><span class="dv">10</span>, WTSUPP))</a>
<a class="sourceLine" id="cb20-18" data-line-number="18"></a>
<a class="sourceLine" id="cb20-19" data-line-number="19">x_label &lt;-<span class="st"> </span><span class="kw">ipums_var_label</span>(cps_data, HEALTH)</a>
<a class="sourceLine" id="cb20-20" data-line-number="20">source_info &lt;-<span class="st"> </span><span class="kw">ipums_file_info</span>(cps_ddi, <span class="st">&quot;ipums_project&quot;</span>)</a>
<a class="sourceLine" id="cb20-21" data-line-number="21"></a>
<a class="sourceLine" id="cb20-22" data-line-number="22"><span class="kw">ggplot</span>(pct_emp_by_health_age, <span class="kw">aes</span>(<span class="dt">x =</span> HEALTH_factor, <span class="dt">y =</span> emp_pct)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-23" data-line-number="23"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;#00263a&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-24" data-line-number="24"><span class="st">  </span><span class="kw">scale_x_discrete</span>(x_label) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-25" data-line-number="25"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Percent employed&quot;</span>, <span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>AGE_factor, <span class="dt">ncol =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-27" data-line-number="27"><span class="st">  </span><span class="kw">labs</span>(</a>
<a class="sourceLine" id="cb20-28" data-line-number="28">    <span class="dt">title =</span> <span class="st">&quot;Low Self-Reported Health Status Correlated with Unemployment&quot;</span>, </a>
<a class="sourceLine" id="cb20-29" data-line-number="29">    <span class="dt">subtitle =</span> <span class="st">&quot;Among age 15+ from CPS 2011 ASEC sample&quot;</span>,</a>
<a class="sourceLine" id="cb20-30" data-line-number="30">    <span class="dt">caption =</span> <span class="kw">paste0</span>(<span class="st">&quot;Source: &quot;</span>, source_info)</a>
<a class="sourceLine" id="cb20-31" data-line-number="31">  )</a></code></pre></div>
</section>
</section>
</section>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
